---
title: "Post-Gibbs sampling summary"
author: "Harly Durbin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)

source(here::here("source_functions/read_gibbs.R"))
```

# Notes & questions

* MCE: Assuming effect 0 corresponds to residual?
* Effective sample size: "At least > 10 is recommended. > 30 may be better."
* `postgibbs_samples` file: "The meaning of each column is:
    + Column 1: the sequential number for saved samples.
    + Column 2: the actual round in which each sample was drawn.
    + Column 3: the number of parameters.
    + Column 4 or later: actual samples ordered by the position index."

---

Sampling parameters:
* 200,000 samples
* Keep every 20th sample after 10,000 sample burn-in

# Monte Carlo error by time series

```{r, message= FALSE, warning=FALSE}
gibbs_mce <-
  purrr::map2_dfr(.x = rep(c(1:5), 
                           times = 6),
                  .y = rep(c(1, 2, 5, 7, 8, 9),
                           times = 5),
                  ~ read_gibbs_mce(iteration = .x,
                                 region = .y))
```

# Posterior standard deviation

```{r, message= FALSE, warning=FALSE}
gibbs_psd <-
  purrr::map2_dfr(.x = rep(c(1:5), 
                           times = 6),
                  .y = rep(c(1, 2, 5, 7, 8, 9),
                           times = 5),
                  ~ read_gibbs_psd(iteration = .x,
                                 region = .y))

```

# Post burn-in samples

```{r, message= FALSE, warning=FALSE}
gibbs_samples <-
  purrr::map2_dfr(.x = rep(c(1:5), 
                           times = 6),
                  .y = rep(c(1, 2, 5, 7, 8, 9),
                           times = 5),
                  ~ read_gibbs_samples(iteration = .x,
                                 region = .y)) %>% 
  select(iter, dataset, everything(), -X1, -X3) %>% 
  purrr::set_names("iter", "dataset", "round", c(1:18)) %>% 
  tidyr::pivot_longer(cols = c(`1`:`18`),
                      names_to = "param") %>% 
  mutate(param = case_when(param == "1" ~ "d1d1",
                           param == "2" ~ "d1d2",
                           param == "3" ~ "d1m1",
                           param == "4" ~ "d1m2",
                           param == "5" ~ "d2d2",
                           param == "6" ~ "d2m1",
                           param == "7" ~ "d2m2",
                           param == "8" ~ "m1m1",
                           param == "9" ~ "m1m2",
                           param == "10" ~ "m2m2",
                           param == "11" ~ "mpe1mpe1",
                           param == "12" ~ "mpe2mpe2",
                           param == "13" ~ "r1r1",
                           param == "14" ~ "r2r2",
                           param == "15" ~ "se(d1d2)",
                           param == "16" ~ "se(m1m2)",
                           param == "17" ~ "se(d1m1)",
                           param == "18" ~ "se(d2m2)"))
``` 

## Plot samples

```{r, fig.width=10, fig.height=10}
gibbs_samples %>% 
  ggplot(aes(x = round, y = value, color = param)) +
  geom_line() +
  facet_wrap(~ dataset)

```
