---
title: "Post-Gibbs sampling summary"
author: "Harly Durbin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
```

# Notes & questions

* Assuming effect 0 corresponds to residual?
* Effective sample size: "At least > 10 is recommended. > 30 may be better."
* `postgibbs_samples` file: "The meaning of each column is:
    + Column 1: the sequential number for saved samples.
    + Column 2: the actual round in which each sample was drawn.
    + Column 3: the number of parameters.
    + Column 4 or later: actual samples ordered by the position index."

---

Sampling parameters:
* 200,000 samples
* Keep every 20th sample after 10,000 sample burn-in

# Import "Monte Carlo error by time series"

Assuming effect 0 corresponds to residual?

```{r}
gibbs_mce <-
  purrr::map2(.x = c(1, 2, 3, 4, 5)) read_table2(here::here("data/derived_data/varcomp_ww/iter2/3v1/postout"), skip = 4, n_max = 15, col_names = c("position", "eff1", "eff2", "trt1", "trt2", "mce", "mean", "hdp", "effective_sample_size", "median", "mode"))
```

# Import "posterior standard deviation"

```{r}
read_table2(here::here("data/derived_data/varcomp_ww/iter2/3v1/postout"), skip = 27, n_max = 15, col_names = c("position", "eff1", "eff2", "trt1", "trt2", "psd", "mean", "psd_interval_lo", "psd_interval_hi", "convergence", "auto_lag1", "auto_lag10", "auto_lag50", "independent_batches")) 
```

# Import samples

```{r, message=FALSE, warning=FALSE}
gibbs30 <-
  c("3v1", "3v2", "3v5", "3v7", "3v8", "3v9") %>%
  purrr::set_names() %>% 
  purrr::map_dfr(~ read_table2(here::here(glue::glue("data/derived_data/varcomp_ww/iter2/{.x}/postgibbs_samples")), col_names = FALSE), .id = "region") %>% 
  janitor::remove_empty(which = c("rows", "cols")) %>% 
  select(-X3, -X2) %>% 
  select(region:X18) %>% 
  tidyr::pivot_longer(cols = X4:X18) %>%
rename(sample = X1, variable = name)
```

## Plot samples

```{r, fig.width=10, fig.height=10}
gibbs30 %>% 
  ggplot(aes(x = sample, y = value, color = variable)) +
  geom_line() +
  facet_wrap(~ region)

```

```{r, fig.width=5, fig.height=5}
gibbs_samples %>% 
  filter(variable == "X9") %>% 
  filter(region == "3v1") %>% 
  ggplot(aes(x = value)) +
  geom_histogram()

```